{% extends "base.njk" %}

{% block content %}
  {% if title %}
    <h1 class="post-title-with-date">
      {{ title }}
      {% if page.date and "/posts/" in page.filePathStem %}
        <span class="post-date-inline">{{ page.date | date("d LLL yyyy") }}</span>
      {% endif %}
    </h1>
  {% endif %}
  {{ content | safe }}
  {% if "/posts/" in page.filePathStem %}
  <hr>
  <div class="subscribe-form">
  <form id="subscribe-form">
  <label for="email">subscribe:</label>
  <input type="email" id="email" name="email" required>
  <button type="submit">submit</button>
  <p id="response-msg" style="margin-top: 0.5rem;"></p>
  </form>

  <script>
  document.getElementById("subscribe-form").addEventListener("submit", async function(e) {
    e.preventDefault();

    const email = document.getElementById("email").value;
    const responseMsg = document.getElementById("response-msg");

    try {
      const response = await fetch("/.netlify/functions/subscribe", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ email })
      });

      const result = await response.json();
      responseMsg.textContent = result.message || "Something went wrong.";
    } catch (error) {
      responseMsg.textContent = "Failed to connect to server.";
    }
  });
  </script>
  </div>
{% endif %}
{% endblock %}
