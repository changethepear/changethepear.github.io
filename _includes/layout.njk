{% extends "base.njk" %}

{% block content %}
  {% if title %}
    <h1 class="post-title-with-date">
      {{ title }}
      {% if page.date and "/posts/" in page.filePathStem %}
        <span class="post-date-inline">{{ page.date | date("d LLL yyyy") }}</span>
      {% endif %}
    </h1>
  {% endif %}
  {{ content | safe }}
  {% if "/posts/" in page.filePathStem %}
  <hr>
  <div class="subscribe-form">
  <form id="subscribe-form">
  <label for="email">subscribe for more!</label>
  <input type="email" id="email" name="email" required>
  <button class="subscribe-button" type="submit">submit</button>
  <p id="response-msg"></p>
</form>
<script>
  document.getElementById("subscribe-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const email = document.getElementById("email").value;
    const responseMsg = document.getElementById("response-msg");

    const response = await fetch("/.netlify/functions/subscribe", {
      method: "POST",
      body: JSON.stringify({ email }),
    });

    const result = await response.json();
    responseMsg.textContent = result.message || "Something went wrong.";
  });
</script>
  </div>
{% endif %}
{% endblock %}
